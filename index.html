<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
	<title>Confocal</title>
	<META HTTP-EQUIV="CACHE-CONTROL" CONTENT="NO-CACHE">

	
	<link rel="shortcut icon" href="IMG/favicon.png">
	
	<link rel="stylesheet" type="text/css" href="JS/yui/build/reset-fonts-grids/reset-fonts-grids.css"> 
	<link rel="stylesheet" type="text/css" href="JS/yui/build/fonts/fonts-min.css" />
	<link rel="stylesheet" type="text/css" href="JS/yui/build/autocomplete/assets/skins/sam/autocomplete.css" />
	<link rel="stylesheet" type="text/css" href="JS/yui/build/button/assets/skins/sam/button.css" />
	<link rel="stylesheet" type="text/css" href="JS/yui/build/container/assets/skins/sam/container.css" />
	<link type="text/css" rel="stylesheet" href="JS/yui/build/logger/assets/skins/sam/logger.css">
	<link rel="stylesheet" type="text/css" href="JS/yui/build/slider/assets/skins/sam/slider.css" />
	<link rel="stylesheet" type="text/css" href="JS/yui/build/editor/assets/skins/sam/editor.css" />
    <link rel="stylesheet" type="text/css" href="JS/yui/build/menu/assets/skins/sam/menu.css">
	<link rel="stylesheet" type="text/css" href="JS/yui/build/calendar/assets/skins/sam/calendar.css" />
	<link rel="stylesheet" type="text/css" href="JS/yui/build/progressbar/assets/skins/sam/progressbar.css" />
	<link rel="stylesheet" type="text/css" href="JS/yui/build/tabview/assets/skins/sam/tabview.css" />

	
	<link rel="stylesheet" type="text/css" href="CSS/confocal.css" />
	<link rel="stylesheet" type="text/css" href="CSS/MicrosCopy.css" />
	<link rel="stylesheet" type="text/css" href="CSS/calExperimentSelect.css" />
	<link rel="stylesheet" type="text/css" href="CSS/autoCompleteConfocal.css" />
	<link rel="stylesheet" type="text/css" href="CSS/index.css" />
	<link rel="stylesheet" type="text/css" href="CSS/status.css" />
	
	<link rel="stylesheet" type="text/css" href="JS/jQCloud/jqcloud/jqcloud.css" />
    <script type="text/javascript" src="JS/jquery/jquery.js"></script>
    <script type="text/javascript" src="JS/jQCloud/jqcloud/jqcloud-1.0.3.js"></script>
	
	<script type="text/javascript" src="JS/Core/errors.js"></script>
	<script type="text/javascript" src="JS/Core/labels.js"></script>

	<script type="text/javascript" src="JS/Core/combo.js"></script>
	<script type="text/javascript" src="JS/Core/itemWindow.js"></script>
	<script type="text/javascript" src="JS/Core/progressBar.js"></script>
	<script type="text/javascript" src="JS/Core/dialog_alert.js"></script>
	<script type="text/javascript" src="JS/Core/status.js"></script>
	<script type="text/javascript" src="JS/Core/calExperimentSelect.js"></script>
	<script type="text/javascript" src="JS/Core/autoCompleteConfocal.js"></script>
	<script type="text/javascript" src="JS/Core/menubar.js"></script>
	
	
	<script type="text/javascript" src="JS/load_conf.js"></script>
	<script type="text/javascript" src="JS/Step1.js"></script>
	<script type="text/javascript" src="JS/high.js"></script>
	<script type="text/javascript" src="JS/ImageJ.js"></script>
	<script type="text/javascript" src="JS/micro.js"></script>
	<script type="text/javascript" src="JS/stitching.js"></script>
	<script type="text/javascript" src="JS/Core/loading.js"></script>
	


	

	<script type="text/javascript" src="JS/join.js"></script>
	<script type="text/javascript" src="JS/iPlay.js"></script>
	
	<script type="text/javascript" src="JS/yui/build/yahoo-dom-event/yahoo-dom-event.js"></script>
	<script type="text/javascript" src="JS/yui/build/yahoo/yahoo-min.js"></script>
	<script type="text/javascript" src="JS/yui/build/event/event-min.js"></script>
	
	<script type="text/javascript" src="JS/yui/build/connection/connection-min.js"></script>
	<script type="text/javascript" src="JS/yui/build/animation/animation-min.js"></script>
	<script type="text/javascript" src="JS/yui/build/element/element-min.js"></script>
	<script type="text/javascript" src="JS/yui/build/datasource/datasource-min.js"></script>
	<script type="text/javascript" src="JS/yui/build/autocomplete/autocomplete-min.js"></script>
	
	<script type="text/javascript" src="JS/yui/build/button/button-min.js"></script>
	<script type="text/javascript" src="JS/yui/build/dragdrop/dragdrop-min.js"></script>
	<script type="text/javascript" src="JS/yui/build/container/container-min.js"></script>
	<script type="text/javascript" src="JS/yui/build/slider/slider-min.js"></script>
	<script type="text/javascript" src="JS/yui/build/menu/menu-min.js"></script>
	<script type="text/javascript" src="JS/yui/build/editor/editor-min.js"></script>
	<script type="text/javascript" src="JS/yui/build/calendar/calendar-min.js"></script>
	<script type="text/javascript" src="JS/yui/build/progressbar/progressbar-min.js"></script>
	<script type="text/javascript" src="JS/yui/build/tabview/tabview-min.js"></script>
	
	<!-- Source file -->
	<script src="JS/yui/build/logger/logger-min.js"></script>
	
	<script type="text/javascript" src="JS/Admin/DialogApp.js"></script>
	<script type="text/javascript" src="JS/Admin/ManageDialogApp.js"></script>
	<script type="text/javascript" src="JS/Admin/ResetApp.js"></script>

	
	<script type="text/javascript" src="JS/ManageMacros/DialogMacro.js"></script>
	<script type="text/javascript" src="JS/ManageMacros/ManageDialogMacro.js"></script>
	<script type="text/javascript" src="JS/ManageMacros/UploadMacro.js"></script>
	<script type="text/javascript" src="JS/ManageMacros/ViewMacro.js"></script>
	<script type="text/javascript" src="JS/ManageMacros/DeleteMacro.js"></script>
	<script type="text/javascript" src="JS/ManageMacros/MoveMacro.js"></script>

	<script type="text/javascript" src="JS/ManageMicrosCopy/DialogMicrosCopy.js"></script>
	<script type="text/javascript" src="JS/ManageMicrosCopy/ManageDialogMicrosCopy.js"></script>
	<script type="text/javascript" src="JS/ManageMicrosCopy/AddMicrosCopy.js"></script>
	<script type="text/javascript" src="JS/ManageMicrosCopy/DeleteMicrosCopy.js"></script>
	<script type="text/javascript" src="JS/ManageMicrosCopy/AddParcentricity.js"></script>
	<script type="text/javascript" src="JS/ManageMicrosCopy/DeleteParcentricity.js"></script>

	<script type="text/javascript" src="JS/Experiment/DialogExperiment.js"></script>
	<script type="text/javascript" src="JS/Experiment/ManageDialogExperiment.js"></script>
	<script type="text/javascript" src="JS/Experiment/SaveExperiment.js"></script>
	<script type="text/javascript" src="JS/Experiment/LoadExperiment.js"></script>


	
</head>

<body  class="yui-skin-sam">
	<div id='top' class="top" >
		<div class="head">
			<div class="myTitle">iMSRC</div>
			<div id="currentMicro"></div>
		</div>
		<div id="barmenu" class="yuimenubar yuimenubarnav">

		</div>

	</div>
	<div id='content' class="content" >
		<div id="element_windows">	
			<div id="myLogger"></div>
			<div id="doc">					
				<div id="bd">
					<div id="yui-main">
						<div class="yui-b">
						</div>
			
					</div>
		
		
					<div class="bloques" id="pSelectMicro"></div>
					<div class="bloques" id="pStep1"></div>
					<div class="bloques" id="pImagej"></div>
					<div class="bloques" id="pstephight"></div>
					<div class="bloques" id="pStitching"></div>
				</div>

			</div>	
		</div>
	</div>
	<div id='bottom' class='bottom'>
		<div class="footer">
			<div class='left'>
				<a href="http://bioinfo.cnio.es/" target="_blank"><img border=0 src="IMG/logo.png" /></a>
			</div>
			<div class='center'>
				<img border=0 src="IMG/LOGOCONFO.png">
			</div>
			<div class='right'>
				<img border=0 src="IMG/logo-cnio.png">
			</div>
		</div>
	</div>
</div>
</body>
</html>


<script>
var myLogReader;
var myLogWriter;
var Loading;
function fnLoadHandler(oEvent, message) { 
	            console.log(message); 
				Loading.hide();
				document.getElementById('bottom').style.display='block';
				
	        }

YAHOO.util.Event.on(window, "load", fnLoadHandler, "Loading ..."); 
YAHOO.util.Event.onDOMReady(function () {

console.log('ini'); 
Loading=new loading(document.body);
	// 
	document.getElementById('bottom').style.display='none';

	myLogReader = new YAHOO.widget.LogReader('myLogger', {footerEnabled:false,verboseOutput:false});
	myLogWriter = new YAHOO.widget.LogWriter("MyClass"); 
	myLogReader.hide(); 
	var manager=new YAHOO.widget.OverlayManager();
	
	var MyMicro=new micro("SelectMicro",document.getElementById('pSelectMicro'),manager);
	MyMicro.show();
	
	
	var dialogResetApp=new ResetApp(manager);

	var dialogUploadMacro=new UploadMacro(manager,MyMicro);
	var dialogViewMacro=new ViewMacro(manager,MyMicro);
	var dialogDeleteMacro=new DeleteMacro(manager,MyMicro);
	var dialogMoveMacro=new MoveMacro(manager,MyMicro);
	
	
	
		
	var DialogAddMicrosCopy=new AddMicrosCopy(manager);
	var DialogDeleteMicrosCopy=new DeleteMicrosCopy(manager,MyMicro.getAllMicros());
	
	var DialogAddParcentricity=new AddParcentricity(manager,MyMicro.currentMicro);
	var DialogDeleteParcentricity=new DeleteParcentricity(manager,MyMicro.currentMicro);
		
	var imagejObj;
	if(MyMicro.error >=0)
	{
		var step=new step1("Step1",document.getElementById('pStep1'),manager,MyMicro);
		var highobj=new high("stephight",document.getElementById('pstephight'),manager,MyMicro);
		
		stitching=new stitching("stitching",document.getElementById('pStitching'),manager,MyMicro);
		imagejObj=new imagej("imagej",document.getElementById('pImagej'),manager,MyMicro);
		
		if(step.MicroIsUse)
		{
			imagejObj.disabledAllButtons();
		}
		
		
		
		dialogDeleteMacro.DeleteMacroEvent.subscribe(function(event,args,me)
											{
												me[0].RefreshList();
												me[1].RefreshList();
											},[imagejObj,stitching]);
											
								
											
		imagejObj.lockEvent.subscribe(function(event,args,me){
											me.disabledAllButtons();
											},step);
											
		step.unlockEvent.subscribe(function(event,args,me){
											me.enabledAllButtons();
											},imagejObj);
		step.lockEvent.subscribe(function(event,args,me){
											me.disabledAllButtons();
										},imagejObj);
										
		imagejObj.onRemoveBlacksEvent.subscribe(function(event,args,me){
													var display=eval(args[0]);
													if(display)
													{
														me.show();
													}
													else
													{
														me.hide();
													}
												},stitching);
	
	
		imagejObj.onFinishedEvent.subscribe(function(event,args,me)
		{
			highobj.template_step2=args[1];
			stitching.template_step2=args[1];
			highobj.newTemplates(args[0]);
			highobj.PlayStep2Btn.set('disabled',false);
		});
		
		imagejObj.onChangeTemplateStep2Event.subscribe(function(event,args,me)
		{			
			highobj.template_step2=args;
			stitching.template_step2=args;
		});
		// 
		// var mngMacro=new ManageMacro(MyMicro);
		// 
		// mngMacro.changeMacros.subscribe(function(event,args,me){
		// 															step.refresh();
		// 															
		// 															mngMacro.updateComboMacro(args);
		// 															
		// 														});
	
		// var microscopy=new MicrosCopy(document.body);
	
		var myjoin=new join(document.body,manager,MyMicro);
	
		// if(step.error == -1)
		// {
		// 	microscopy.new(false);
		// }
		// 
		
		
		MyMicro.changeMicroEvent.subscribe(function(event,args,me)
											{
												DialogDeleteParcentricity.setMicro(args);
												DialogAddParcentricity.setMicro(args);
												me.refresh();
											},myjoin);
		
		var dialogSaveExperiment=new SaveExperiment(manager,MyMicro,step,imagejObj,highobj,stitching);
		var dialogLoadExperiment=new LoadExperiment(manager,MyMicro,step,imagejObj,highobj,stitching);
		
		
		var menu=new menubar('barmenu',manager);
		
		menu.onClickMenu.subscribe(function(event,args){
				
				var itemMenuSelect=args[0];
				if(itemMenuSelect=='#add_macro')
				{
					dialogUploadMacro.show();
				}
				if(itemMenuSelect=='#delete_macro')
				{
					dialogDeleteMacro.show();
				}
				if(itemMenuSelect=='#move_macro')
				{
					dialogMoveMacro.show();
				}
				if(itemMenuSelect=='#view_macro')
				{
					dialogViewMacro.show();
				}
				if(itemMenuSelect=='#insert_micro')
				{
					DialogAddMicrosCopy.show();
				}
				if(itemMenuSelect=='#delete_micro')
				{
					DialogDeleteMicrosCopy.show();
				}				
				if(itemMenuSelect=='#add_parcentricity')
				{
					DialogAddParcentricity.show();
				}
				if(itemMenuSelect=='#delete_parcentricity')
				{
					DialogDeleteParcentricity.show();
				}
				// if(itemMenuSelect=='#insert_objetive')
				// {
				// 	// microscopy.new_objetive();
				// }
				if(itemMenuSelect=='#show_join_templates')
				{
					myjoin.join_templates();
				}
				if(itemMenuSelect=='#show_log')
				{
					myLogReader.show();
				}	
				if(itemMenuSelect=='#hide_log')
				{
					myLogReader.hide();
				}
				if(itemMenuSelect=='#show_stitching')
				{
					var display=eval(args[1]);
					if(display)
					{
						stitching.show();
						step.hide();
						// imagejObj.hide();
						highobj.hide();
					}
					else
					{
						stitching.hide();
						step.show();
						// imagejObj.show();
						highobj.show();
					}
				}
				if(itemMenuSelect=='#reset_app')
				{
					dialogResetApp.show();
				}
				if(itemMenuSelect=='#save_experiment')
				{
					dialogSaveExperiment.show();
				}
				if(itemMenuSelect=='#load_experiment')
				{
					dialogLoadExperiment.show();
				}
	
		});
		var iPlayObj=new iPlay('control_process',[step,imagejObj,highobj]);
	}
	else
	{
		if(MyMicro.error==-3)
		{
			DialogAddMicrosCopy.show();
		}
	}
});
</script>


